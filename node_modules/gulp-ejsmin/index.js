'use strict';
var PluginError, assign, createPluginError, ejsMin, through;

through = require('through2');

assign = require('object-assign');

PluginError = require('gulp-util').PluginError;

createPluginError = function(message) {
  return new PluginError('gulp-ejsmin', message);
};

ejsMin = function(options) {
  var dafault;
  dafault = {
    removeComment: false
  };
  options = assign(dafault, options);
  return through.obj(function(file, enc, done) {
    var input, output;
    if (file.isNull()) {
      this.push(file);
      return done();
    }
    if (file.isStream()) {
      this.emit('error', createPluginError('stream content is not supported'));
      return done();
    }
    input = file.contents.toString();
    output = options.removeComment ? input.replace(/<!--([\s\S]*?)-->/g, '') : input;
    output = output.replace(/\n+[\s]*/g, '');
    file.contents = new Buffer(output);
    this.push(file);
    return done();
  });
};

module.exports = ejsMin;
